name: build lacells.db

on: 
  schedule:
    - cron: '0 0 * * *' 
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Update
        run: |
          sudo apt update
          sudo apt upgrade -y
      - name: Free Disk Space (Ubuntu)
        uses: jlumbroso/free-disk-space@main
        with:
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          docker-images: true
          swap-storage: true
        
      - name: Update token
        env:
          TOKEN_OCID: ${{ secrets.TOKEN_OCID }}
        run: |
          sed -i "s/XXXXXXXXXXXXXX/$TOKEN_OCID/g" config
          sed -i "s/XXXXXXXXXXXXXX/$TOKEN_OCID/g" flg
      - name: generate lacells
        run: bash flg
      - name: Release "lacells"
        uses: softprops/action-gh-release@v1
        with:
          body: |
            To Use lacells.db, install apk from this [link](https://gitlab.com/-/project/23195867/uploads/3e5994177ce852bb7bf5b74743b6d99b/LocalGSMBackend.apk) and place lacells.db to /sdcard/Android/data/org.fitchfamily.android.gsmlocation/files/lacells.db
            Note: You need to Install UnifiedNlp from this [link](https://github.com/microg/UnifiedNlp/releases/download/v1.6.8/UnifiedNlp.apk) and integrate it to system via magisk [module](https://github.com/misaka4e21/magisk-unifiednlp-aosp-enabler)
          tag_name: github_run
          name: lacells.db Database
          files: |
             lacells.db
